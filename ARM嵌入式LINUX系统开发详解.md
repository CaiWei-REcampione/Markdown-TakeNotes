# 嵌入式系统入门

## 什么是嵌入式系统

可以把嵌入式系统理解为一种为特定设备服务的软件硬件可裁剪的计算机
系统。

## 嵌入式系统应用领域

*    家用电器和电子类产品

*    交通工具

*    公共电子设施

## 嵌入式系统发展

嵌入式系统的种类繁多， 按照系统硬件的核心处理器来说， 可以分成嵌入式微控制器和嵌入式微处理器。

### 嵌入式微控制器

嵌入式微控制器也就是传统意义上的单片机， 它可以说是目前嵌入式系统的前身。

单片机就是把一个计算机的主要功能集成到了一个芯片上， 简单说，单片机就是一个计算机。 它的特点是体积小、 结构简单、 便于开发， 以及价格经济。

### 嵌入式微处理器

嵌入式处理器在一个芯片上集成了复杂的功能， 同时一些微处理器还把常见的外部设备控制器也集成到芯片内部。 

由于嵌入式微处理器提供了强大的处理能力， 一些厂商以及计算机爱好者在嵌入式微 处理器上面开发了操作系统， 帮助使用嵌入式系统的人简化开发、 提高工作效率， 这在单片机上是很难实现的。

在一个嵌入式微处理器内部集成了许多外部设备控制器。 这种设计方法大大简化了外部电路的设计和调试， 同时整个系统的硬件体积也大幅缩小。

## 典型的嵌入式系统组成

与传统计算机不同的是，嵌入式系统种类繁多。许多的芯片厂商、软件厂商加入其中，
导致有多种硬件和软件， 甚至解决方案。 一般来说， 不同的嵌入式系统的软、 硬件是很难
兼容的， 软件必须修改， 而硬件必须重新设计才能使用。 虽然软、硬件种类繁多， 但是不同的嵌入式系统还是有很多相同之处的。

硬件部分可以分成嵌入式处理器和外部设备。 处理器是整个系统的核心， 负责处理所有的软件程序以及外部设备的信号。 外部设备在不同的系统中有不同的选择。 

软件部分可以分成两层，最靠近硬件的是嵌入式操作系统。操作系统是软硬件的接口，负责管理系统的所有软件和硬件资源。 操作系统还可以通过驱动程序与外部设备打交道。最上层的是应用软件， 应用软件利用操作系统提供的功能开发出针对某个需求的程序， 供用户使用。

# 嵌入式软硬件系统

## 电路基本知识

### 模拟电路

处理模拟信号的电路称做模拟电路。 模拟信号的特点是信号是线性变化的，意思是信号变化是连续的。 

### 数字电路

通常数字电路具有逻辑运算和逻辑处理的功能。

与模拟信号不同，数字信号使用电压的高低或者电流的有无表示逻辑上的1或0,因此数字电路可以方便地表示出二进制数。

数字电路可以分成脉冲电路和逻辑电路两部分， 脉冲电路负责信号变换和测量； 逻辑电路负责处理数字逻辑。

与模拟电路不同， 数字电路关心的是信号状态的变化。 通过数字逻辑可以处理复杂的 二进制信息， 因此数字电路是计算机的基础。 

### 数制转换

计算机是由数字电路构成的 ， 其内部数据的传输和处理都使用二进制方式。 

二进制的特点是 “逢2进1”。

与十进制数类似，十六进制数是逢16进1位。

## 计算机组成原理

### 计算机体系的发展

计算机是由硬件系统和软件系统两大部分组成的。 按照功能又可以划分为指令系统、存储系统、 输入输出系统等。 

冯. 诺依曼结构是以数学家 John Von Neumann 的名字命名的，他最早提出了该结构。 该结构把计算机分成了运算器、 控制器、 存储器、 输入设备和输出设备5个部分。 它的工作原理是把让计算机工作的指令（也可理解为程序）存储在存储器内，工作的流程是从存储器取出指令， 由运算器运算指令， 控制器负责处理输入设备和输出设备。

哈佛结构最大的特点就是把指令和数据分开存储。 控制器可以先读取指令，然后交给运算器解码， 得到数据地址后， 控制器读取数据交给运算器：在运算器运算的时候，控制器可以读取下一条指令或者数据。

这种把指令和数据分开存储的方式可以获得较高的执行效率。 

### 中央处理器

中央处理器的英文全称是 Central Process Unit，简称 CPU，是一个计算机系统的核心。

CPU 是由运算器、 控制器、 寄存器和内部总线组成的。 在 CPU 之外再加入总线、 存储设备、 输入输出设备就可以构成 个完整的计算机系统。

输入输出设备就可以构成 个完整的计算机系统。

CPU 有几个重要的参数，包括工作频率、 字长、 指令集和缓存。 工作频率通常是用户最多听到的参数， 一个 CPU 的工作频率包括了主频和外频，以及外部总线频率。 主频是CPU 的实际工作频率，外频是 CPU 工作的基准频率，还有 个是总线的工作频率。

决定 CPU 处理数据能力的是 CPU 的字长，有的教材也称做位宽，它是 CPU 在一个周期期能处理的最大数据宽度。

CPU 内部是通过执行指令工作的。 每种 CPU 都有专门的一组指令， 称为指令集。 

按照指令的执行方式可以把计算机 CPU 指令集分成复杂指令集和精简指令集。 复杂指令集(CISC）的特点是使程序中的指令按照顺序执行。 其优点是结构简单， 便于控制；缺点也很明显， 由于指令顺序执行， 计算机各部分不能同时工作， 执行效率不高。 常见的 CISC指令集 CPU 是 Intel 的 X86 系列。

缓存是 CPU 内部一个重要的器件， 主要用来暂时存储指令和数据， 是由于 CPU 内部和外部工作的速度不同造成的。 一个 CPU 的缓存越大， 相对处理指令的能力就越强。

### 存储系统

由于材料和价格因素的限制， 计算机的存储器件在容量、 速度等方面需要匹配。 存储系统的作用就是设计一个让各种存储器相互配置达到最优性价比的方案。

### 总线系统

总线是CPU连接外部设备的通道。通常包括数据总线（DataBus）、地址总线
( AddressBus）和控制总线（ControlBus）。

地址总线负责向外部设备发送地址信息；数据总线负责从外部设备读取或者写入信息：控制总线负责发送信号控制外部设备。

总线的出现规范了 CPU 和外设之间的通信标准，简化了外部器件的设计。使用一些通用的总线可以有效地降低开发成本。

### 输入输出系统

输入输出系统由外部设备和输入输出控制器组成， 是 CPU 与外部通信的系统。 CPU通过总线与输入输出系统相连。由于外部设备的速度差异， CPU 可以使用不同的方式控制外部设备的访问。 常见的有轮询方式、 中断控制方式和 DMA 方式。

嵌入式系统通常会设计许多的中断信号控制线， 供连接不同的外部设备。

#### DMA

对于这种大量的数据传输可以不通过 CPU 而直接传送到内存，这种方式叫做直接内存访问（ Direct Memory Access ）， 简称 <u>DMA</u>。使用 DMA 方式， 外部 设备在数据准备好之后只需要向 DMA 控制器发送一个命令， 把数据的地址和大小传送过 去， 由 DMA 控制器负责把数据从外部设备直接存放到内存。

## 软件基础知识

嵌入式系统的基础是硬件，软件是嵌入式系统的灵魂。

### 什么是软件

 严格地说， 软件是由程序和文档构成的， 程序是一组按照特 定结构细织的指令和数据集合。

通常软件可以分成系统软件和应用软件，以及目前兴起的介于二者之间的中间件软件。

系统软件是使用计算机提供的基本功能，例如操作系统和数据库系统。
软件的另一个组成部分是文档。 随着软件复杂程度的提高，文档也越来越重要。 常见的软件文档有开发文档和用户文档， 前者面向开发人员，后者面向最终用户。软件开发人员应该养成编写文档的好习惯。

### 软件开发流程

需求分析、 概要设计和详细设计、 编码和调试、 测试和维护

编码调试是最关键的 个环节。该阶段根据需求分析的结果，按照文档的要求在特定的平台和工具环境下完成程序编写和调试的工作。在整个软件开发流程中， 编码调试是占用时间开发流程最长的， 这个过程需要细心和经验丰富的程序员来完成。

测试的目的是找出软件的问题，或者存在的缺陷（Bug）。软件测试可以分成不同层次，代码级别的有单元测试，高层的有集成测试等。测试手段的好坏直接决定了软件的质量。

### 常见的软件开发模型

#### 瀑布模型

瀑布模型把软件开发分成需求阶段、 规格说明阶段、 设计阶段和实现阶段。需求阶段由系统分析师确定整个系统的功能需求， 被认可后制定整体的规格并且建立文档。进入设计阶段后，系统分析员按照模块划分整个系统， 并且设计每个模块的功能和接口。最后在完成阶段由程序员完成模块的编码调试，组合成完整的软件。瀑布模型使线型结构便于管理， 被广泛地应用在软件开发团队中。

#### 增量模型

增量模型的思想是，通过不断增加软件的功能完成整个系统。该模型首先开发出一个基本的软件框架，然后在上面不断增加新的功能。增加功能是按照特定的步骤和策略完成的， 最终的目标是完成所有的需求。增量模型的好处是可以让用户尽早地看到软件产品，可以提出意见促进以后的修改。

#### 统一软件开发模型

统一软件开发模型借鉴了之前的成功经验和失败教训，融入了瀑布模型和增量模型的思想。统一软件开发模型把个软件项目分成初始阶段、 细化阶段、 构造阶段和移交阶段。 在每个阶段中保留了瀑布模型的工作流程。在整体的流程上采用增量模型的迭代思想， 不断演进， 最终达到所有需求完成的目标。 统 个复杂的开发过程，适合大型的软件系统。该模型还制定了过程描述语言UML，可以帮助开发人员减少开发过程中的错误。

### 计算机编程语言

计算机语言可以分成机器语言、 汇编语言和高级语言。 

#### 机器语言

机器语言是供计算机本身识别的， 为二进制串。 

#### 汇编语言

汇编语言是对机器语言的抽象， 其实质与机器语言是相同的。汇编语言的指令与机器语言是一对应的。 此外， 汇编语言还设计了伪指令和宏指令， 帮助编程人员提高开发效率。汇编语言是依赖体系结构的，在一种CPU上能执行的汇编语言在其他CPU上可能就无法执行了。

#### 高级语言

高级语言从程序的功能角度出发， 从各种功能中抽象出计算机可以处理的方法提供给用户。 用户可以像使用类似自然语言样书写程序， 极大地提高了开发效率。 高级语言的一个功能或者说是个函数可能对应汇编语言的若干条指令。嵌入式系统开发中常见的高级语言有C和C＋＋。

#### 解释语言

无论是汇编语言还是高级语言都不能被计算机直接执行， 需要转换为机器语言，这个过程叫做编译。 对于高级语言来说， 还有类解释型的语言，通过特定的解释器可以边解释用户编写的程序内容边输出结果。常见的脚本语言都属于解释语言。

### 数据结构

计算机的本质是处理数据的机器。 数据是计算机加工和处理的对象。 计算机中的数据有很多种类， 如何处理数据就成为了一门学问。 

数据结构包括数据逻辑结构、 物理结构和数据操作3方面的内容。

计算机把处理的数据分成多种类型， 包括一些基本结构类型。 数据结构中认为数据元素是基本的类型。 数据的逻辑结构描述数据元素之间的逻辑关系， 是抽象出来的数学模型， 与具体的机器无关。
数据的物理结构描述数据元素的存储结构， 依赖于具体的计算机实现。

## 操作系统知识

#### 什么是操作系统

操作系统是一类特殊的系统软件。 它管理整个系统的所有硬件和软件， 通常是整个计算机系统中最接近硬件的系统软件。 操作系统屏蔽了硬件的底层特性， 向应用软件提供了一个统一的接口。 对于应用软件来说， 不需要知道硬件的具体特性， 使用操作系统提供的接口即可完成相应的功能。 除此之外， 操作系统通过特定的算法统筹安排整个计算机系统软硬件资源， 使计算机的资源利用率更高， 甚至获得比硬件更多的功能。

#### 操作系统由什么组成

按照软件的结构划分， 操作系统可以分成内核、 驱动程序和程序库。 内核是操作系统的核心， 也是整个系统软件的核心。

*    内核从抽象的层面提供最基本的功能， 通常代码短小精炼。 
*    驱动程序是计算机系统必不可少的一类系统软件， 系统和驱动程序打交道而不会直接访问硬件， 硬件的具体细节由驱动程序完成， 是软硬件的接口。 
*    程序库是操作系统向用户提供的程序接口。

#### 几种操作系统的设计思路

通常内核有简单结构、 层次结构、 微内核结构和虚拟机结构等。

##### 简单结构

简单结构比较好理解， 内核中各种功能没有严格的界限， 混杂在一起。

##### 层次结构

层次结构的设计思想是把内核需要提供的功能划分出层次， 最底层仅提供抽象出来的最基本的功能， 每一层利用下面的一层功能， 以此类推， 最上面的层可以提供丰富的功能。 这种设计思路结构清晰是操作系统内核的一大进步。

##### 微内核结构

其设计思想是内核提供最基本最核心
的功能， 注重把系统的服务功能和基本操作分开。 

### 操作系统分类

按照用户角度可以分成单用户和多用户操作系统。 单用户操作系统仅支持一个用户， 特点是系统利用率低，但是便于管理；多用户操作系统支持数个用户， 并且同时可以运行多个用户的程序，提高了资源利用率，但是管理难度也相应提高。

按照系统对任务的处理相应时间来划分， 可以把操作系统分成分时系统和实时系统。分时系统中，不同用户的进程按照定的策略分别得到 CPU 资源，未能得到资源的用户只能等待。 实时系统则不然， 任务是按照优先级和响应时间分配的， 在一个设定的响应时间内， 任务必须得到响应。

随着网络的发展，现在出现了分布式操作系统。通过把一个网络内的计算机资源共享，个计算任务可以分散在不同的计算机上进行， 最后把结果汇总。 分布式操作系统能最大限度地利用现有的资源， 得到强大的计算能力， 是未来科学计算领域的一个发展趋势。